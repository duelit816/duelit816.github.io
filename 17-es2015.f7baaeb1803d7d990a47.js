(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{XRCK:function(e,t,i){"use strict";i.r(t);var n=i("ofXK"),a=i("3Pt+"),s=i("1kSV"),r=i("ftNi"),c=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},imports:[[n.c]]}),e})(),l=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},imports:[[n.c,o]]}),e})(),u=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},imports:[[n.c]]}),e})(),b=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},imports:[[n.c,u]]}),e})();var p=i("S48G"),d=i("geAU"),m=i("tyNb"),g=i("Znnd"),h=i("wd/R"),f=i("XNiG"),y=i("2Vo4"),C=i("LRne"),v=i("1G5W"),T=i("JIr8"),O=i("lJxs"),S=i("SLWe"),k=i("YGOX"),w=i("qc5V"),P=i("aVeI"),_=i("lbBO"),U=i("BamM"),I=i("J+vq"),A=i("h7dw");let q=(()=>{class e{constructor(e,t,i){this.el=e,this.renderer=t,this.keen=i,this.viewInit=!1,this.loading=!0}ngOnInit(){this.renderer.addClass(this.el.nativeElement,"duelit-keen-data")}ngOnChanges(){this.query&&this.viewInit&&(this.el.nativeElement.innerHTML='<span class="duelit-keen-data loading"></span>',this.doQuery())}doQuery(){if(this.el.nativeElement.innerHTML='<span class="duelit-keen-data loading"></span>',this.chart=new I.Dataviz({container:`.${this.duelitkeenname}`,title:"metric"===this.viewType&&this.title,type:this.viewType,legend:{pagination:{limit:10}},labelMapping:{Regular:"Challenge",Open:"Tournament","Practice game":"Practice"}}),this.query.eventCollection instanceof Array){const e=[];this.query.eventCollection.forEach(t=>{e.push(this.keen.query(this.queryType,{eventCollection:t,timeframe:this.query.timeframe,timezone:"UTC"}))}),this.keen.run(e).then(e=>{const t=[];t.push({type:"Accepted",result:e[1].result},{type:"Rejected",result:e[0].result-e[1].result}),this.chart.render({query:{timeframe:this.query.timeframe,timezone:"UTC"},result:t})})}else this.loading=!0,this.keen.query(this.queryType,this.query).then(e=>{setTimeout(()=>{this.isCombined&&this.apiResult?(e.result=[e.result.find(e=>"Practice game"===e["Game.type"])],this.apiResult.subscribe(t=>{t.forEach(t=>{e.result.push({"Game.type":t.type,result:t.count})}),this.chart.render(e)})):this.chart.render(e)}),this.loading=!1}).catch(e=>{setTimeout(()=>{this.chart.message(e.message)}),this.loading=!1})}ngAfterViewInit(){this.viewInit=!0,this.doQuery()}}return e.\u0275fac=function(t){return new(t||e)(c.Pb(c.l),c.Pb(c.F),c.Pb(A.a))},e.\u0275dir=c.Kb({type:e,selectors:[["","duelitKeenData",""]],inputs:{duelitkeenname:"duelitkeenname",viewType:"viewType",queryType:"queryType",query:"query",title:"title",isCombined:"isCombined",apiResult:"apiResult"},features:[c.Ab()]}),e})(),x=(()=>{class e{constructor(){this.loading=!0,this.viewInit=!1}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-keen"]],inputs:{title:"title",keenName:"keenName",viewType:"viewType",queryType:"queryType",query:"query",subTitle:"subTitle",isCombined:"isCombined",apiResult:"apiResult"},decls:3,vars:11,consts:[["duelitKeenData","",1,"duelit-keen-data",3,"duelitkeenname","viewType","queryType","query","title","ngClass","isCombined","apiResult"]],template:function(e,t){1&e&&(c.Vb(0,"h6"),c.Lc(1),c.Ub(),c.Qb(2,"div",0)),2&e&&(c.Cb(1),c.Mc(t.title),c.Cb(1),c.Hb("metric","metric"===t.viewType),c.rc("duelitkeenname",t.keenName)("viewType",t.viewType)("queryType",t.queryType)("query",t.query)("title",t.subTitle)("ngClass",t.keenName)("isCombined",t.isCombined)("apiResult",t.apiResult))},directives:[q,n.l],styles:["[_nghost-%COMP%]   .duelit-keen-data[_ngcontent-%COMP%]{height:250px;width:auto;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}[_nghost-%COMP%]   .duelit-keen-data[_ngcontent-%COMP%]     span.loading{height:120px;width:120px;background-size:120px 120px}[_nghost-%COMP%]   .duelit-keen-data.metric[_ngcontent-%COMP%]{height:unset}"]}),e})();var R=i("Jx61");function $(e,t){1&e&&c.Qb(0,"duelit-keen-api",11),2&e&&c.rc("keenApiInput",t.$implicit)}function V(e,t){if(1&e&&(c.Tb(0),c.Jc(1,$,1,1,"duelit-keen-api",10),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function j(e,t){if(1&e&&c.Qb(0,"duelit-keen",12),2&e){const e=t.$implicit,i=c.lc();c.rc("title",e.title)("keenName",e.keenname)("viewType",e.viewType)("queryType",e.queryType)("query",e.query)("isCombined",e.isCombined)("apiResult",i.tournamentCountPerType$)}}function M(e,t){1&e&&c.Qb(0,"duelit-metric",14),2&e&&c.rc("metric",t.$implicit)}function D(e,t){if(1&e&&(c.Tb(0),c.Jc(1,M,1,1,"duelit-metric",13),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function J(e,t){if(1&e&&(c.Tb(0),c.Qb(1,"duelit-keen-api",11),c.Sb()),2&e){const e=c.lc();c.Cb(1),c.rc("keenApiInput",e.challengeRatioStats$)}}function E(e,t){if(1&e){const e=c.Wb();c.Vb(0,"duelit-metric",16),c.hc("click",(function(){c.Cc(e);const i=t.$implicit;return c.lc(2).openUsersSignup(i)})),c.Ub()}2&e&&c.rc("metric",t.$implicit)}function Q(e,t){if(1&e&&(c.Tb(0),c.Jc(1,E,1,1,"duelit-metric",15),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function F(e,t){if(1&e&&(c.Tb(0),c.Qb(1,"duelit-keen-api",11),c.Sb()),2&e){const e=c.lc();c.Cb(1),c.rc("keenApiInput",e.signupRatioStats$)}}function L(e,t){if(1&e&&c.Qb(0,"duelit-keen",17),2&e){const e=t.$implicit;c.rc("title",e.title)("keenName",e.keenname)("viewType",e.viewType)("queryType",e.queryType)("query",e.query)}}function N(e,t){if(1&e&&c.Qb(0,"duelit-keen",18),2&e){const e=t.$implicit;c.rc("title",e.title)("keenName",e.keenname)("viewType",e.viewType)("queryType",e.queryType)("query",e.query)}}function B(e,t){1&e&&c.Qb(0,"duelit-keen-api",11),2&e&&c.rc("keenApiInput",t.$implicit)}function G(e,t){if(1&e&&(c.Tb(0),c.Jc(1,B,1,1,"duelit-keen-api",10),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function z(e,t){if(1&e){const e=c.Wb();c.Vb(0,"duelit-metric",16),c.hc("click",(function(){return c.Cc(e),c.lc(2).openActiveUsers()})),c.Ub()}2&e&&c.rc("metric",t.$implicit)}function H(e,t){if(1&e&&(c.Tb(0),c.Jc(1,z,1,1,"duelit-metric",15),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function Y(e,t){if(1&e){const e=c.Wb();c.Vb(0,"duelit-metric",16),c.hc("click",(function(){return c.Cc(e),c.lc(2).openUsersByBanned()})),c.Ub()}2&e&&c.rc("metric",t.$implicit)}function K(e,t){if(1&e&&(c.Tb(0),c.Jc(1,Y,1,1,"duelit-metric",15),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function X(e,t){1&e&&(c.Vb(0,"div",19),c.Qb(1,"span",20),c.Ub())}const W=h().subtract(6,"days").format(S.c),Z=h().format(S.c);let ee=(()=>{class e{constructor(e,t,i,n){this.api=e,this.dashboardDate=t,this.router=i,this.numberPipe=n,this.gamesQueries=[{title:"Daily Games",keenname:"daily-games",viewType:"line",queryType:"count",query:{eventCollection:"Game played",groupBy:"Game.name",timeframe:{start:W,end:Z},interval:"daily",filters:[{property_name:"Game.name",operator:"ne",property_value:null}]}},{title:"Games Per Type",keenname:"games-per-type",viewType:"pie",queryType:"count",query:{eventCollection:"Game played",groupBy:"Game.type",timeframe:{start:W,end:Z}},isCombined:!0}],this.engagement1Queries=[{title:"Total Challenges",keenname:"challenges-total",viewType:"metric",queryType:"count",query:{eventCollection:"Challenge created",timeframe:{start:W,end:Z}}},{title:"Accepted Challenges",keenname:"challenges-accepted",viewType:"metric",queryType:"count",query:{eventCollection:"Challenge accepted",timeframe:{start:W,end:Z}}},{title:"Challenge Ratio",keenname:"challenge-ratio",viewType:"pie",queryType:"count",query:{eventCollection:["Challenge created","Challenge accepted"],timeframe:{start:W,end:Z}}}],this.engagement3Queries=[{title:"Total App Launched",keenname:"app-launced-total",viewType:"metric",queryType:"count",query:{eventCollection:"App launched",timeframe:{start:W,end:Z}}}],this.engagement4Queries=[{title:"Games Per OS",keenname:"games-per-os",viewType:"pie",queryType:"count",query:{eventCollection:"Game played",groupBy:"Device.OS",timeframe:{start:W,end:Z},filters:[{property_name:"Device.OS",operator:"exists",property_value:!0}]}}],this.signupRatioStats$={title:"Signup Ratio",classSelector:"signup-ratio",viewType:"pie"},this.challengeRatioStats$={title:"Challenge Ratio",classSelector:"challenge-ratio",viewType:"pie"},this.ngUnsubscribe=new f.a,this.FAILED_TO_RETRIEVE="-"}ngOnInit(){this.rangeDate=new a.d(this.dashboardDate.range),this.rangeDate.valueChanges.pipe(Object(v.a)(this.ngUnsubscribe)).subscribe(e=>{this.dashboardDate.range=e}),this.date$=new y.a(this.dashboardDate.range),this.date$.pipe(Object(v.a)(this.ngUnsubscribe)).subscribe(({from:e,to:t})=>{const i=h().year(e.year).month(e.month-1).date(e.day).format(S.c),n=h().year(t.year).month(t.month-1).date(t.day).format(S.c);this.getRevenueStats(i,n),this.getSignupTypeStats(i,n),this.getSignupCountStats(i,n),this.getSignupRatioStats(),this.getActiveUsersStats(i,n),this.getChallengeStats(i,n),this.getTournamentCountPerType(i,n),this.getChallengeRatioStats(),this.getUserStats(i,n),this.updateQueries(this.engagement1Queries,i,n),this.updateQueries(this.engagement3Queries,i,n),this.updateQueries(this.engagement4Queries,i,n),this.updateQueries(this.gamesQueries,i,n)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.date$.complete()}getRevenueStats(e,t){this.revenueStats$=this.api.get(g.a.RevenueStats,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])),Object(O.a)(e=>{const t=[];let i=[];e.length&&(i=[{type:"Duelit",result:e.reduce((e,t)=>e+t.duelit_revenue,0)},{type:"Player",result:e.reduce((e,t)=>e+t.player_revenue,0)}]),t.push({title:"Revenue Generated",classSelector:"revenue1",viewType:"bar",data:i}),t.push({title:"Revenue Generated (Percentage)",classSelector:"revenue2",viewType:"pie",data:i});const n={title:"Revenue by Game (Duelit)",classSelector:"revenue3",viewType:"pie",data:e.map(e=>({type:e.game,result:e.duelit_revenue}))};return t.push(n),t}))}getSignupTypeStats(e,t){this.signupTypeStats$=this.api.get(g.e.SignupType,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])),Object(O.a)(e=>{const t=[];return"0"===e.facebook&&"0"===e.apple&&"0"===e.email||Object.keys(e).forEach(i=>{t.push({type:i.charAt(0).toUpperCase()+i.slice(1),result:e[i]})}),[{title:"Signup Type",classSelector:"signup-type",viewType:"pie",data:t}]}))}getSignupCountStats(e,t){this.signupCountStats$=this.api.get(g.e.SignupCount,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])),Object(O.a)(e=>[{name:S.b.SignupCount,title:"Total Sign Ups",subTitle:"Count - Sign up",data:this.numberPipe.transform(e.signups)},{name:S.b.ActivatedSignupCount,title:"Total Activated Sign Ups",subTitle:"Count - Sign up activated",data:this.numberPipe.transform(e.activated)}]))}getSignupRatioStats(){this.signupCountStats$.subscribe(e=>{let t=0;e[0].data&&e[1].data&&(t=e[0].data.replace(/,/g,"")-e[1].data.replace(/,/g,""));const i=[{type:"Activated",result:e[1].data?e[1].data.replace(/,/g,""):0},{type:"Pending",result:t}];this.signupRatioStats$={title:"Signup Ratio",classSelector:"signup-ratio",viewType:"pie",data:i}})}getActiveUsersStats(e,t){this.activeUsersStats$=this.api.get(g.e.ActiveUsersStats,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])),Object(O.a)(e=>[{title:"Active Users",subTitle:"Count - Active Users",data:e.active_users_count}]))}getChallengeStats(e,t){this.challengeStats$=this.api.get(g.d.ChallengeStats,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])),Object(O.a)(e=>[{title:"Cancelled",subTitle:"Cancelled Challenges",data:e.cancelled?this.numberPipe.transform(e.cancelled):0},{title:"Completed",subTitle:"Completed Challenges",data:e.completed?this.numberPipe.transform(e.completed):0}]))}getTournamentCountPerType(e,t){this.tournamentCountPerType$=this.api.get(g.d.TournamentCountPerType,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)([])))}getChallengeRatioStats(){this.challengeStats$.subscribe(e=>{const t=[{type:"Cancelled",result:e[0].data?e[0].data.replace(/,/g,""):0},{type:"Completed",result:e[1].data?e[1].data.replace(/,/g,""):0}];this.challengeRatioStats$={title:"Challenge Ratio",classSelector:"challenge-ratio",viewType:"pie",data:t}})}getUserStats(e,t){const i=this.api.buildPath(g.e.UsersCountByStatus,["banned"]);this.userStats$=this.api.get(i,{query:{start_date:h(e).format(S.c),end_date:h(t).format(S.c)}}).pipe(Object(T.a)(e=>Object(C.a)(e.error.text||this.FAILED_TO_RETRIEVE)),Object(O.a)(e=>[{title:"Total Banned Users",subTitle:"Count - Banned Users",data:e}]))}updateQueries(e,t,i){let n;n=t===i&&t===h().format(S.c)?"this_1_days":{start:t,end:i},e.forEach(e=>{"string"!=typeof e.query.timeframe&&(e.query=Object.assign(Object.assign({},e.query),{timeframe:n}))})}updateDate(){this.date$.next(Object.assign({},this.dashboardDate.range))}isDateRangeValid(){const e=this.rangeDate.value;return e.from&&e.to}openUsersSignup(e){const{from:t,to:i}=this.date$.getValue(),n=Object(k.b)(t).format(S.c),a=Object(k.b)(i).format(S.c);this.router.navigate(["/admin/users"],{queryParams:{created_start_date:n,created_end_date:a,not_status:e.name===S.b.ActivatedSignupCount?"pending":""}})}openUsersByBanned(){const{from:e,to:t}=this.date$.getValue(),i=Object(k.b)(e).format(S.c),n=Object(k.b)(t).format(S.c);this.router.navigate(["/admin/users"],{queryParams:{status:S.f.Banned,start_date:i,end_date:n}})}openUsersByTransaction(e){const{from:t,to:i}=this.date$.getValue(),n=Object(k.b)(t).format(S.c),a=Object(k.b)(i).format(S.c);this.router.navigate(["/admin/users"],{queryParams:{transaction:S.e.RedeemCoinsRequest,start_date:n,end_date:a}})}openActiveUsers(){const{from:e,to:t}=this.date$.getValue(),i=Object(k.b)(e).format(S.c),n=Object(k.b)(t).format(S.c);this.router.navigate(["/admin/users"],{queryParams:{last_active_start_date:i,last_active_end_date:n}})}}return e.\u0275fac=function(t){return new(t||e)(c.Pb(w.a),c.Pb(P.a),c.Pb(m.b),c.Pb(n.f))},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-app-data"]],decls:43,vars:37,consts:[[1,"date-filter"],[3,"formControl"],[1,"btn","custom","primary",3,"disabled","click"],[1,"row","container"],[4,"ngIf","ngIfElse"],["class","col-6",3,"title","keenName","viewType","queryType","query","isCombined","apiResult",4,"ngFor","ngForOf"],["class","col metric",3,"title","keenName","viewType","queryType","query",4,"ngFor","ngForOf"],["class","col-6 metric",3,"title","keenName","viewType","queryType","query",4,"ngFor","ngForOf"],[1,"col-4"],["loading",""],["class","col-4",3,"keenApiInput",4,"ngFor","ngForOf"],[1,"col-4",3,"keenApiInput"],[1,"col-6",3,"title","keenName","viewType","queryType","query","isCombined","apiResult"],["class","col-4 pointer",3,"metric",4,"ngFor","ngForOf"],[1,"col-4","pointer",3,"metric"],["class","col-4 pointer",3,"metric","click",4,"ngFor","ngForOf"],[1,"col-4","pointer",3,"metric","click"],[1,"col","metric",3,"title","keenName","viewType","queryType","query"],[1,"col-6","metric",3,"title","keenName","viewType","queryType","query"],[1,"col","col-loading"],[1,"metric","loading"]],template:function(e,t){if(1&e&&(c.Vb(0,"div",0),c.Qb(1,"duelit-date-picker-range",1),c.Vb(2,"button",2),c.hc("click",(function(){return t.updateDate()})),c.Lc(3,"Filter"),c.Ub(),c.Ub(),c.Vb(4,"div"),c.Vb(5,"h4"),c.Lc(6,"Revenue"),c.Ub(),c.Vb(7,"div",3),c.Jc(8,V,2,1,"ng-container",4),c.mc(9,"async"),c.Ub(),c.Vb(10,"h4"),c.Lc(11,"Games"),c.Ub(),c.Vb(12,"div",3),c.Jc(13,j,1,7,"duelit-keen",5),c.Ub(),c.Vb(14,"h4"),c.Lc(15,"Engagement"),c.Ub(),c.Vb(16,"div",3),c.Jc(17,D,2,1,"ng-container",4),c.mc(18,"async"),c.Jc(19,J,2,1,"ng-container",4),c.mc(20,"async"),c.Ub(),c.Vb(21,"div",3),c.Jc(22,Q,2,1,"ng-container",4),c.mc(23,"async"),c.Jc(24,F,2,1,"ng-container",4),c.mc(25,"async"),c.Ub(),c.Vb(26,"div",3),c.Jc(27,L,1,5,"duelit-keen",6),c.Ub(),c.Vb(28,"div",3),c.Jc(29,N,1,5,"duelit-keen",7),c.Ub(),c.Vb(30,"h4"),c.Lc(31,"User Statistics"),c.Ub(),c.Vb(32,"div",3),c.Jc(33,G,2,1,"ng-container",4),c.mc(34,"async"),c.Jc(35,H,2,1,"ng-container",4),c.mc(36,"async"),c.Jc(37,K,2,1,"ng-container",4),c.mc(38,"async"),c.Qb(39,"div",8),c.Qb(40,"div",8),c.Ub(),c.Ub(),c.Jc(41,X,2,0,"ng-template",null,9,c.Kc)),2&e){const e=c.zc(42);c.Cb(1),c.rc("formControl",t.rangeDate),c.Cb(1),c.rc("disabled",!t.isDateRangeValid()),c.Cb(6),c.rc("ngIf",c.nc(9,21,t.revenueStats$))("ngIfElse",e),c.Cb(5),c.rc("ngForOf",t.gamesQueries),c.Cb(4),c.rc("ngIf",c.nc(18,23,t.challengeStats$))("ngIfElse",e),c.Cb(2),c.rc("ngIf",c.nc(20,25,t.challengeStats$))("ngIfElse",e),c.Cb(3),c.rc("ngIf",c.nc(23,27,t.signupCountStats$))("ngIfElse",e),c.Cb(2),c.rc("ngIf",c.nc(25,29,t.signupCountStats$))("ngIfElse",e),c.Cb(3),c.rc("ngForOf",t.engagement3Queries),c.Cb(2),c.rc("ngForOf",t.engagement4Queries),c.Cb(4),c.rc("ngIf",c.nc(34,31,t.signupTypeStats$))("ngIfElse",e),c.Cb(2),c.rc("ngIf",c.nc(36,33,t.activeUsersStats$))("ngIfElse",e),c.Cb(2),c.rc("ngIf",c.nc(38,35,t.userStats$))("ngIfElse",e)}},directives:[_.a,a.l,a.e,n.n,n.m,U.a,x,R.a],pipes:[n.b],styles:["[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:40px}[_nghost-%COMP%]   span.metric.loading[_ngcontent-%COMP%]{height:120px;width:120px;background-size:120px 120px}[_nghost-%COMP%]   .col-loading[_ngcontent-%COMP%]{-webkit-box-pack:center;justify-content:center;display:-webkit-box;display:flex}[_nghost-%COMP%]   .date-filter[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:end;justify-content:flex-end;-webkit-box-align:center;align-items:center}[_nghost-%COMP%]   .date-filter[_ngcontent-%COMP%]   .btn.custom.primary[_ngcontent-%COMP%]{margin-left:15px}[_nghost-%COMP%]  .revenue1 .c3-bar-1{fill:#fe6672!important}"]}),e})();var te=i("5+tZ"),ie=i("Olgc");function ne(e,t){1&e&&c.Qb(0,"duelit-metric",8),2&e&&c.rc("metric",t.$implicit)}function ae(e,t){if(1&e&&(c.Tb(0),c.Jc(1,ne,1,1,"duelit-metric",7),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function se(e,t){if(1&e){const e=c.Wb();c.Vb(0,"duelit-metric",10),c.hc("click",(function(){c.Cc(e);const i=t.$implicit;return c.lc(2).openUsersByTransaction(i)})),c.Ub()}2&e&&c.rc("metric",t.$implicit)}function re(e,t){if(1&e&&(c.Tb(0),c.Jc(1,se,1,1,"duelit-metric",9),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function ce(e,t){1&e&&(c.Vb(0,"div",11),c.Qb(1,"span",12),c.Ub())}function oe(e,t){if(1&e){const e=c.Wb();c.Vb(0,"duelit-metric",14),c.hc("click",(function(){c.Cc(e);const i=t.$implicit;return c.lc(2).openUsersByTransaction(i)})),c.Ub()}2&e&&c.rc("metric",t.$implicit)}function le(e,t){if(1&e&&(c.Tb(0),c.Jc(1,oe,1,1,"duelit-metric",13),c.Sb()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function ue(e,t){if(1&e&&(c.Tb(0),c.Qb(1,"duelit-metric",15),c.Sb()),2&e){const e=c.lc();c.Cb(1),c.rc("metric",e.totalProfitStats$)}}let be=(()=>{class e{constructor(e,t,i,n,a,s){this.api=e,this.dashboardDate=t,this.toast=i,this.router=n,this.numberPipe=a,this.currencyPipe=s,this.ngUnsubscribe=new f.a}ngOnInit(){this.rangeDate=new a.d(this.dashboardDate.range),this.rangeDate.valueChanges.pipe(Object(v.a)(this.ngUnsubscribe)).subscribe(e=>{this.dashboardDate.range=e}),this.date$=new y.a(this.dashboardDate.range),this.totalCredits$=this.api.get(g.c.TotalCredits).pipe(Object(T.a)(e=>Object(C.a)({totalCoins:0,giftedCoins:0})),Object(O.a)(e=>[{title:"Total Coins",subTitle:"Count - Total In-game Coins",data:e.totalCoins?this.numberPipe.transform(e.totalCoins):"0"},{title:"Total Gifted Coins",subTitle:"Count - Total Gifted Coins",data:e.giftedCoins?this.numberPipe.transform(e.giftedCoins):"0"}])),this.date$.subscribe(({from:e,to:t})=>{const i=Object(k.b)(e).format(S.c),n=Object(k.b)(t).format(S.c);this.getRedeemedStats(i,n),this.getTotalProfitStats(),this.productsSold$=this.api.get(g.c.PurchasedCoins,{query:{start_date:i,end_date:n}}).pipe(Object(T.a)(e=>(this.toast.error(e.error||e.statusText||e.message),Object(C.a)([{amount:"4.99",count:0},{amount:"9.99",count:0},{amount:"25.99",count:0},{amount:"49.99",count:0}]))),Object(O.a)(e=>e.map(e=>({name:S.b.PurchasedCount,title:null,subTitle:`Count - Total Purchased $${e.amount}`,data:e.count,amount:Number(e.amount)}))))})}updateDate(){this.date$.next(Object.assign({},this.dashboardDate.range))}isDateRangeValid(){const e=this.rangeDate.value;return e.from&&e.to}getRedeemedStats(e,t){this.redeemedStats$=this.api.get(g.c.RedeemedCoins,{query:{start_date:e,end_date:t}}).pipe(Object(T.a)(e=>Object(C.a)({totalAmount:S.d,playerCount:S.d})),Object(O.a)(e=>{let t,i;try{t=parseInt(e.totalAmount),i=Math.floor(.00825*t*100)/100}catch(a){console.log("Invalid coin amount",a)}let n="$0<br>0 coins";return i&&t&&(n=`${this.currencyPipe.transform(i)}<br>${this.numberPipe.transform(t)} coins`),[{name:S.b.RedeemCount,title:"Total Redeems",subTitle:"Redeem Stats",data:n,class:"coin-dollar-metric",amount:i},{name:S.b.RedeemCount,title:"Redeemed Players Count",subTitle:"Count - Players Count",data:e.playerCount}]}))}getTotalProfitStats(){let e;this.redeemedStats$.pipe(Object(te.a)(t=>(e=t[0].amount,this.productsSold$))).subscribe(t=>{const i=t.reduce((e,t)=>e+t.amount*Number(t.data),0)-e;let n="$0<br>0 coins";i&&(n=`${this.currencyPipe.transform(i)}<br>${this.numberPipe.transform(Math.floor(i/.00825))} coins`),this.totalProfitStats$={title:"Total Profit",subTitle:"Total Profit Stats",data:n,class:"coin-dollar-metric"}})}openUsersByTransaction(e){const{from:t,to:i}=this.date$.getValue(),n=Object(k.b)(t).format(S.c),a=Object(k.b)(i).format(S.c),s={transaction:S.e.RedeemCoinsRequest,start_date:n,end_date:a};e.name===S.b.PurchasedCount&&(s.transaction=S.e.Transaction,s.amount=e.amount),this.router.navigate(["/admin/users"],{queryParams:s})}}return e.\u0275fac=function(t){return new(t||e)(c.Pb(w.a),c.Pb(P.a),c.Pb(ie.a),c.Pb(m.b),c.Pb(n.f),c.Pb(n.d))},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-finance"]],decls:27,vars:18,consts:[[1,"row","container"],[4,"ngIf","ngIfElse"],[1,"divider"],[1,"date-filter"],[3,"formControl"],[1,"btn","custom","primary",3,"disabled","click"],["loading",""],["class","col-6",3,"metric",4,"ngFor","ngForOf"],[1,"col-6",3,"metric"],["class","col-3 pointer",3,"metric","click",4,"ngFor","ngForOf"],[1,"col-3","pointer",3,"metric","click"],[1,"col","col-loading"],[1,"metric","loading"],["class","col-6 pointer",3,"metric","click",4,"ngFor","ngForOf"],[1,"col-6","pointer",3,"metric","click"],[1,"col-12",3,"metric"]],template:function(e,t){if(1&e&&(c.Vb(0,"h4"),c.Lc(1,"Coins"),c.Ub(),c.Vb(2,"div",0),c.Jc(3,ae,2,1,"ng-container",1),c.mc(4,"async"),c.Ub(),c.Qb(5,"div",2),c.Vb(6,"div",3),c.Qb(7,"duelit-date-picker-range",4),c.Vb(8,"button",5),c.hc("click",(function(){return t.updateDate()})),c.Lc(9,"Filter"),c.Ub(),c.Ub(),c.Vb(10,"h4"),c.Lc(11,"Purchased Product"),c.Ub(),c.Vb(12,"div",0),c.Jc(13,re,2,1,"ng-container",1),c.mc(14,"async"),c.Ub(),c.Jc(15,ce,2,0,"ng-template",null,6,c.Kc),c.Vb(17,"h4"),c.Lc(18,"Redeemed Coins"),c.Ub(),c.Vb(19,"div",0),c.Jc(20,le,2,1,"ng-container",1),c.mc(21,"async"),c.Ub(),c.Vb(22,"h4"),c.Lc(23,"Total Profit"),c.Ub(),c.Vb(24,"div",0),c.Jc(25,ue,2,1,"ng-container",1),c.mc(26,"async"),c.Ub()),2&e){const e=c.zc(16);c.Cb(3),c.rc("ngIf",c.nc(4,10,t.totalCredits$))("ngIfElse",e),c.Cb(4),c.rc("formControl",t.rangeDate),c.Cb(1),c.rc("disabled",!t.isDateRangeValid()),c.Cb(5),c.rc("ngIf",c.nc(14,12,t.productsSold$))("ngIfElse",e),c.Cb(7),c.rc("ngIf",c.nc(21,14,t.redeemedStats$))("ngIfElse",e),c.Cb(5),c.rc("ngIf",c.nc(26,16,t.redeemedStats$))("ngIfElse",e)}},directives:[n.n,_.a,a.l,a.e,n.m,R.a],pipes:[n.b],styles:["[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:40px}[_nghost-%COMP%]   span.metric.loading[_ngcontent-%COMP%]{height:120px;width:120px;background-size:120px 120px}[_nghost-%COMP%]   .col-loading[_ngcontent-%COMP%]{-webkit-box-pack:center;justify-content:center;display:-webkit-box;display:flex}[_nghost-%COMP%]   .date-filter[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:end;justify-content:flex-end;-webkit-box-align:center;align-items:center}[_nghost-%COMP%]   .date-filter[_ngcontent-%COMP%]   .btn.custom.primary[_ngcontent-%COMP%]{margin-left:15px}[_nghost-%COMP%]  .revenue1 .c3-bar-1{fill:#fe6672!important}",".divider[_ngcontent-%COMP%]{margin-top:50px;margin-bottom:20px}"]}),e})();var pe=i("PqYM"),de=i("l7GE"),me=i("ZUHj");class ge{constructor(e){this.notifier=e}call(e,t){return t.subscribe(new he(e,this.notifier,t))}}class he extends de.a{constructor(e,t,i){super(e),this.notifier=t,this.source=i,this.sourceIsBeingSubscribedTo=!0}notifyNext(e,t,i,n,a){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)}notifyComplete(e){if(!1===this.sourceIsBeingSubscribedTo)return super.complete()}complete(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return super.complete();this._unsubscribeAndRecycle(),this.notifications.next()}}_unsubscribe(){const{notifications:e,retriesSubscription:t}=this;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null}_unsubscribeAndRecycle(){const{_unsubscribe:e}=this;return this._unsubscribe=null,super._unsubscribeAndRecycle(),this._unsubscribe=e,this}subscribeToRetries(){let e;this.notifications=new f.a;try{const{notifier:t}=this;e=t(this.notifications)}catch(t){return super.complete()}this.retries=e,this.retriesSubscription=Object(me.a)(this,e)}}var fe=i("bOdf");const ye={asc:"desc",desc:"","":"asc"};let Ce=(()=>{class e{constructor(){this.duelitSortable="",this.direction="",this.tableName="",this.sort=new c.o}get _t(){return!0}get isAscending(){return"asc"===this.direction}get isDescending(){return"desc"===this.direction}rotate(){this.direction=ye[this.direction],this.sort.emit({column:this.duelitSortable,direction:this.direction})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=c.Kb({type:e,selectors:[["th","duelitSortable",""]],hostVars:6,hostBindings:function(e,t){1&e&&c.hc("click",(function(e){return t.rotate(e)})),2&e&&c.Hb("pointer",t._t)("asc",t.isAscending)("desc",t.isDescending)},inputs:{duelitSortable:"duelitSortable",direction:"direction",tableName:"tableName"},outputs:{sort:"sort"}}),e})();function ve(e,t){if(1&e){const e=c.Wb();c.Vb(0,"th",5),c.hc("sort",(function(t){return c.Cc(e),c.lc(2).onSort(t)})),c.Lc(1),c.Ub()}if(2&e){const e=t.$implicit;c.rc("duelitSortable",e),c.Cb(1),c.Mc(e.name)}}function Te(e,t){if(1&e&&(c.Vb(0,"th",8),c.Lc(1),c.Ub()),2&e){const e=c.lc().$implicit;c.Cb(1),c.Mc(e)}}function Oe(e,t){if(1&e&&(c.Vb(0,"td"),c.Lc(1),c.Ub()),2&e){const e=c.lc().$implicit;c.Cb(1),c.Mc(e)}}function Se(e,t){if(1&e&&(c.Tb(0),c.Jc(1,Te,2,1,"th",6),c.Jc(2,Oe,2,1,"ng-template",null,7,c.Kc),c.Sb()),2&e){const e=t.index,i=c.zc(3);c.Cb(1),c.rc("ngIf",0===e)("ngIfElse",i)}}function ke(e,t){if(1&e&&(c.Vb(0,"tr"),c.Jc(1,Se,4,2,"ng-container",4),c.Ub()),2&e){const e=t.$implicit;c.Cb(1),c.rc("ngForOf",e)}}function we(e,t){if(1&e&&(c.Vb(0,"table",2),c.Vb(1,"thead"),c.Vb(2,"tr"),c.Jc(3,ve,2,2,"th",3),c.Ub(),c.Ub(),c.Vb(4,"tbody"),c.Jc(5,ke,2,1,"tr",4),c.Ub(),c.Ub()),2&e){const e=c.lc();c.Cb(3),c.rc("ngForOf",e.headerMapping),c.Cb(2),c.rc("ngForOf",e.tableData)}}function Pe(e,t){1&e&&c.Lc(0," No data to show.\n")}let _e=(()=>{class e{constructor(){this.headerMapping=[],this.data=[],this.sort=new c.o,this.sortDirection=""}ngOnInit(){}getData(e,t){let i=t;return e.split(".").forEach(e=>i=i[e]),String(i)}get tableData(){return this.data.map(e=>this.headerMapping.map(t=>this.getData(t.path,e))).sort((e,t)=>{let i=this.headerMapping.indexOf(this.sortColumn);i<0&&(i=0);const n=(a=e[i])<(s=t[i])?-1:a>s?1:0;var a,s;return"desc"===this.sortDirection?-1*n:n})}onSort({column:e,direction:t}){this.headers.forEach(t=>{t.duelitSortable!==e&&(t.direction="")}),this.sortColumn=e,this.sortDirection=t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-table"]],viewQuery:function(e,t){var i;1&e&&c.Qc(Ce,!0),2&e&&c.yc(i=c.ic())&&(t.headers=i)},inputs:{headerMapping:"headerMapping",data:"data",tableName:"tableName"},outputs:{sort:"sort"},decls:3,vars:2,consts:[["class","table table-striped",4,"ngIf","ngIfElse"],["noData",""],[1,"table","table-striped"],["scope","col",3,"duelitSortable","sort",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["scope","col",3,"duelitSortable","sort"],["scope","row",4,"ngIf","ngIfElse"],["td",""],["scope","row"]],template:function(e,t){if(1&e&&(c.Jc(0,we,6,2,"table",0),c.Jc(1,Pe,1,0,"ng-template",null,1,c.Kc)),2&e){const e=c.zc(2);c.rc("ngIf",t.data.length)("ngIfElse",e)}},directives:[n.n,n.m,Ce],styles:['th.asc[_ngcontent-%COMP%]:before, th.desc[_ngcontent-%COMP%]:before{content:"";display:block;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAmxJREFUeAHtmksrRVEUx72fH8CIGQNJkpGUUmakDEiZSJRIZsRQmCkTJRmZmJgQE0kpX0D5DJKJgff7v+ru2u3O3vvc67TOvsdatdrnnP1Y///v7HvvubdbUiIhBISAEBACQkAICAEhIAQ4CXSh2DnyDfmCPEG2Iv9F9MPlM/LHyAecdyMzHYNwR3fdNK/OH9HXl1UCozD24TCvILxizEDWIEzA0FcM8woCgRrJCoS5PIwrANQSMAJX1LEI9bqpQo4JYNFFKRSvIgsxHDVnqZgIkPnNBM0rIGtYk9YOOsqgbgepRCfdbmFtqhFkVEDVPjJp0+Z6e6hRHhqBKgg6ZDCvYBygVmUoEGoh5JTRvIJwhJo1aUOoh4CLPMyvxxi7EWOMgnCGsXXI1GIXlZUYX7ucU+kbR8NW8lh3O7cue0Pk32MKndfUxQFAwxdirk3fHappAnc0oqDPzDfGTBrCfHP04dM4oTV8cxr0SVzH9FF07xD3ib6xCDE+M+aUcVygtWzzbtGX2rPBrEUYfecfQkaFzYi6HjVnGBdtL7epqAlc1+jRdAap74RrnPc4BCijttY2tRcdN0g17w7HqZrXhdJTYAuS3hd8z+vKgK3V1zWPae0mZDMykadBn1hTQBLnZNwVrJpSe/NwEeDsEwCctEOsJTsgxLvCqUl2ACftEGvJDgjxrnBqkh3ASTvEWrIDQrwrnJpkB3DSDrGW7IAQ7wqnJtkBnLRztejXXVu4+mxz/nQ9jR1w5VB86ejLTFcnnDwhzV+F6T+CHZlx6THSjn76eyyBIOPHyDakhBAQAkJACAgBISAEhIAQYCLwC8JxpAmsEGt6AAAAAElFTkSuQmCC") no-repeat;background-size:auto;background-size:22px;width:22px;height:22px;float:left;margin-left:-22px}th.desc[_ngcontent-%COMP%]:before{-webkit-transform:rotate(180deg);transform:rotate(180deg);-ms-transform:rotate(180deg)}']}),e})();function Ue(e,t){1&e&&(c.Vb(0,"div",3),c.Qb(1,"span",4),c.Ub())}function Ie(e,t){if(1&e&&(c.Tb(0),c.Qb(1,"duelit-table",5),c.Sb()),2&e){const e=t.$implicit,i=c.lc();c.Cb(1),c.rc("data",e)("headerMapping",i.tableHeadersMapping)}}let Ae=(()=>{class e{constructor(e){this.api=e,this.ngUnsubscribe=new f.a,this.POLL_INTERVAL=1e4,this.timer$=new y.a(this.POLL_INTERVAL/1e3),this._stop=new f.a,this._start=new f.a,this.tableHeadersMapping=[{name:"ID",path:"tournament_id"},{name:"Game Name",path:"game_name"},{name:"Joined Players",path:"total_players"},{name:"Real Players",path:"total_real_players"},{name:"Minimum Players",path:"minimum_players"},{name:"Status",path:"status"},{name:"Total Payout",path:"total_payout"},{name:"Level",path:"level"},{name:"Time Left",path:"time_left"}]}ngOnInit(){var e;Object(pe.a)(0,1e3).pipe(Object(O.a)(e=>this.POLL_INTERVAL/1e3-e),Object(v.a)(this._stop),(e=()=>this._start,t=>t.lift(new ge(e)))).subscribe(e=>{this.timer$.next(e)}),this.openTournaments$=Object(pe.a)(0,this.POLL_INTERVAL).pipe(Object(fe.a)(()=>this.api.get(g.d.GetOccupiedOpenTournaments).pipe(Object(T.a)(e=>Object(C.a)({})))),Object(O.a)((e={})=>{null===e&&(e={}),this.restartTimer();let t=this.getTournamentListByStatus(e,"Started");return t=this.mapTimeLeft(t),t}),Object(v.a)(this.ngUnsubscribe))}getTournamentListByStatus(e,t){return Object.keys(e).filter(i=>e[i].status===t).map(t=>e[t])}mapTimeLeft(e){const t=h();return e.filter(e=>{const i=h.utc(e.timer.startAt,"DD/MM/YYYY h:mm:ss");return 0===t.diff(i,"hours")}).map(e=>{const i=h.utc(e.timer.startAt,"DD/MM/YYYY h:mm:ss"),n=h.duration(t.diff(i)),a=10-n.minutes(),s=60-n.seconds();return e.time_left="",a>0&&(e.time_left+=`${a} mins `),e.time_left+=`${s} secs`,e})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}restartTimer(){this._stop.next(),this._start.next()}}return e.\u0275fac=function(t){return new(t||e)(c.Pb(w.a))},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-realtime"]],decls:9,vars:7,consts:[["loading",""],[1,"d-inline","pr-1"],[4,"ngIf","ngIfElse"],[1,"col","col-loading"],[1,"metric","loading"],[3,"data","headerMapping"]],template:function(e,t){if(1&e&&(c.Jc(0,Ue,2,0,"ng-template",null,0,c.Kc),c.Vb(2,"h4",1),c.Lc(3,"Active Tournaments"),c.Ub(),c.Vb(4,"span"),c.Lc(5),c.mc(6,"async"),c.Ub(),c.Jc(7,Ie,2,2,"ng-container",2),c.mc(8,"async")),2&e){const e=c.zc(1);c.Cb(5),c.Nc("(Refreshing in ",c.nc(6,3,t.timer$)," seconds)"),c.Cb(2),c.rc("ngIf",c.nc(8,5,t.openTournaments$))("ngIfElse",e)}},directives:[n.n,_e],pipes:[n.b],styles:[".col-loading[_ngcontent-%COMP%]{-webkit-box-pack:center;justify-content:center;display:-webkit-box;display:flex}[_nghost-%COMP%]     span.loading{height:120px;width:120px;background-size:120px 120px}"]}),e})();function qe(e,t){1&e&&c.Qb(0,"duelit-app-data")}function xe(e,t){1&e&&c.Qb(0,"duelit-finance")}function Re(e,t){1&e&&c.Qb(0,"duelit-realtime")}const $e=[{path:"",component:(()=>{class e{constructor(){this.activeTab="Application Data"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Jb({type:e,selectors:[["duelit-dashboard"]],decls:18,vars:2,consts:[["ngbNav","",1,"nav-tabs",3,"activeId","activeIdChange"],["nav","ngbNav"],["ngbNavItem","Application Data"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","Finance"],["ngbNavItem","Realtime Data"],[1,"timezone"],[1,"mt-2",3,"ngbNavOutlet"]],template:function(e,t){if(1&e&&(c.Vb(0,"ul",0,1),c.hc("activeIdChange",(function(e){return t.activeTab=e})),c.Vb(2,"li",2),c.Vb(3,"a",3),c.Lc(4,"App"),c.Ub(),c.Jc(5,qe,1,0,"ng-template",4),c.Ub(),c.Vb(6,"li",5),c.Vb(7,"a",3),c.Lc(8,"Finance"),c.Ub(),c.Jc(9,xe,1,0,"ng-template",4),c.Ub(),c.Vb(10,"li",6),c.Vb(11,"a",3),c.Lc(12,"Realtime"),c.Ub(),c.Jc(13,Re,1,0,"ng-template",4),c.Ub(),c.Vb(14,"li",7),c.Vb(15,"span"),c.Lc(16,"Timezone: UTC"),c.Ub(),c.Ub(),c.Ub(),c.Qb(17,"div",8)),2&e){const e=c.zc(1);c.rc("activeId",t.activeTab),c.Cb(17),c.rc("ngbNavOutlet",e)}},directives:[s.o,s.q,s.r,s.p,s.t,ee,be,Ae],styles:[".timezone[_ngcontent-%COMP%]{display:-webkit-box;display:flex;float:right;-webkit-box-flex:1;flex-grow:1;-webkit-box-pack:right;justify-content:right;-webkit-box-align:center;align-items:center;padding-right:1em}"]}),e})()}];let Ve=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},imports:[[m.e.forChild($e)],m.e]}),e})();i.d(t,"DashboardModule",(function(){return je}));let je=(()=>{class e{}return e.\u0275mod=c.Nb({type:e}),e.\u0275inj=c.Mb({factory:function(t){return new(t||e)},providers:[n.f,n.d],imports:[[n.c,Ve,s.s,r.a,a.q,u,b,p.a,d.a,l]]}),e})()}}]);